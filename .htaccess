# Отключаем листинг директорий
Options -Indexes

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # 1) Закрываем исходники
  RewriteRule ^(?:includes|templates|\.git)/ - [F,L]

  # 2) Не трогать, если уже идёт к public/
  RewriteRule ^public/ - [L]

  # 3) Если запрошен реальный файл — отдать его (css, js, изображения...)
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule .* - [L]

  # 4) Прописываем явную маршрутизацию search/article/category
  #    ловим и /search.php, и /search
  RewriteRule ^(search|contact|about|info|article|category)(?:\.php)?$ public/$1.php [L,QSA]

  # 5) Всё остальное — единоразово на public/index.php
  RewriteRule ^.*$ public/index.php [L,QSA]
</IfModule>

# Защищаем конфигурационные файлы
<FilesMatch "\.(env|ini|log|sql|json|config|htaccess)$">
  Require all denied
</FilesMatch>

# Кеширование статики
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpeg    "access plus 1 week"
  ExpiresByType image/png     "access plus 1 week"
  ExpiresByType image/gif     "access plus 1 week"
  ExpiresByType text/css      "access plus 2 days"
  ExpiresByType application/javascript "access plus 1 week"
  ExpiresDefault              "access plus 2 days"
</IfModule>
